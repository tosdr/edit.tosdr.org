require 'json'
# require 'pry'

# in repo root, run:
# rails runner db/import_points_from_old_db.rb

filepath_declined = "./old_db/points-declined.json"
filepath_approved = "./old_db/points-approved.json"
filepath_disputed = "./old_db/points-disputed.json"

file_declined = File.read(filepath_declined)
declined = JSON.parse(file_declined)
declined.each do |id, reason|
  point = Point.find_by_id(id)
  if (point.status == 'pending')
    point.status = 'declined'
    puts "declining"
    puts point.id
    comment = Comment.new(
      point: point,
      summary: 'imported status as declined'
    )
    comment.save
    point.save  
  else
    puts "not declining"
    puts point.id
  end
end
file_disputed = File.read(filepath_disputed)
disputed = JSON.parse(file_disputed)
disputed.each do |id, reason|
  point = Point.find_by_id(id)
  if (point.status == 'pending')
    point.status = 'disputed'
    puts "disputing"
    puts point.id
    comment = Comment.new(
      point: point,
      summary: 'imported status as disputed'
    )
    comment.save
    point.save  
  else
    puts "not disputing"
    puts point.id
  end
end
file_approved = File.read(filepath_approved)
approved = JSON.parse(file_disputed)
approved.each do |id, reason|
  point = Point.find_by_id(id)
  if (point.status == 'pending')
    point.status = 'approved'
    puts "approving"
    puts point.id
    comment = Comment.new(
      point: point,
      summary: 'imported status as approved'
    )
    comment.save
    point.save  
  else
    puts "not approving"
    puts point.id
  end
end
puts "Done!"
